<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="配置Fabric－SDK一、配置Fabric－SDK目标 明确SDK-GO的相关配置 使用SDK提供的相关API创建通道并通过测试  任务实现Hyperledger Fabric 提供了许多 SDK 来支持各种不同的编程语言，但是因为 Hyperledger Fabric 是使用 Golang 构建的，所以我们将使用 Go 语言来设计应用程序，包括链码（智能合约）。如果您想使用其它 SDK，如 F">
<meta property="og:type" content="article">
<meta property="og:title" content="第11章Fabric-SDK-Go">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;03&#x2F;27&#x2F;%E8%81%94%E7%9B%9F%E9%93%BE&#x2F;%E7%AC%AC11%E7%AB%A0Web%E5%AE%9E%E6%88%98-%E4%BD%BF%E7%94%A8Fabric-SDK-Go&#x2F;index.html">
<meta property="og:site_name" content="Hongery">
<meta property="og:description" content="配置Fabric－SDK一、配置Fabric－SDK目标 明确SDK-GO的相关配置 使用SDK提供的相关API创建通道并通过测试  任务实现Hyperledger Fabric 提供了许多 SDK 来支持各种不同的编程语言，但是因为 Hyperledger Fabric 是使用 Golang 构建的，所以我们将使用 Go 语言来设计应用程序，包括链码（智能合约）。如果您想使用其它 SDK，如 F">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http:&#x2F;&#x2F;image.chaindesk.cn&#x2F;11.1_5.png&#x2F;mark">
<meta property="og:image" content="http:&#x2F;&#x2F;image.chaindesk.cn&#x2F;11.1_6.png&#x2F;mark">
<meta property="og:image" content="c:%5CUsers%5Chuanggang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200405163727492.png">
<meta property="article:published_time" content="2020-03-27T12:36:33.000Z">
<meta property="article:modified_time" content="2020-04-05T12:51:47.357Z">
<meta property="article:author" content="Hongery">
<meta property="article:tag" content="blockchain">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;image.chaindesk.cn&#x2F;11.1_5.png&#x2F;mark">

<link rel="canonical" href="http://yoursite.com/2020/03/27/%E8%81%94%E7%9B%9F%E9%93%BE/%E7%AC%AC11%E7%AB%A0Web%E5%AE%9E%E6%88%98-%E4%BD%BF%E7%94%A8Fabric-SDK-Go/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>第11章Fabric-SDK-Go | Hongery</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hongery</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">记录学习中的点点滴滴</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/Hongery" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/27/%E8%81%94%E7%9B%9F%E9%93%BE/%E7%AC%AC11%E7%AB%A0Web%E5%AE%9E%E6%88%98-%E4%BD%BF%E7%94%A8Fabric-SDK-Go/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Hongery">
      <meta itemprop="description" content="直到这一刻微笑着说话为止，我至少留下了一公升眼泪">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hongery">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          第11章Fabric-SDK-Go
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-27 20:36:33" itemprop="dateCreated datePublished" datetime="2020-03-27T20:36:33+08:00">2020-03-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-05 20:51:47" itemprop="dateModified" datetime="2020-04-05T20:51:47+08:00">2020-04-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hyperledger-Fabric/" itemprop="url" rel="index">
                    <span itemprop="name">Hyperledger Fabric</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>31k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>28 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="配置Fabric－SDK"><a href="#配置Fabric－SDK" class="headerlink" title="配置Fabric－SDK"></a>配置Fabric－SDK</h3><h2 id="一、配置Fabric－SDK"><a href="#一、配置Fabric－SDK" class="headerlink" title="一、配置Fabric－SDK"></a>一、配置Fabric－SDK</h2><h4 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h4><ol>
<li>明确SDK-GO的相关配置</li>
<li>使用SDK提供的相关API创建通道并通过测试</li>
</ol>
<h4 id="任务实现"><a href="#任务实现" class="headerlink" title="任务实现"></a>任务实现</h4><p>Hyperledger Fabric 提供了许多 SDK 来支持各种不同的编程语言，但是因为 Hyperledger Fabric 是使用 Golang 构建的，所以我们将使用 Go 语言来设计应用程序，包括链码（智能合约）。如果您想使用其它 SDK，如 Fabric-SDK-Java，Fabric-SDK-Node等等，这些都可以通过在线文档进行学习，我们不在这里讨论。</p>
<a id="more"></a>

<h3 id="1-配置Fabric－SDK"><a href="#1-配置Fabric－SDK" class="headerlink" title="1 配置Fabric－SDK"></a>1 配置Fabric－SDK</h3><p>确认 Hyperledger Fabric 基础网络环境运行没有问题后，现在我们通过创建一个新的 config.yaml 配置文件给应用程序所使用的 Fabric-SDK-Go 配置相关参数及 Fabric 组件的通信地址</p>
<p>进入项目的根目录中创建一个 <code>config.yaml</code> 文件并编辑</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/kongyixueyuan.com/kongyixueyuan</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim config.yaml</span></span><br></pre></td></tr></table></figure>

<p>config.yaml 文件完整内容如下:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">"kongyixueyuan-network"</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Schema version of the content. Used by the SDK to apply the corresponding parsing rules.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The client section used by GO SDK.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">client:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Which organization does this application instance belong to? The value must be the name of an org</span></span><br><span class="line">  <span class="comment"># defined under "organizations"</span></span><br><span class="line">  <span class="attr">organization:</span> <span class="string">Org1</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">logging:</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">info</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Global configuration for peer, event service and orderer timeouts</span></span><br><span class="line">  <span class="comment"># if this this section is omitted, then default values will be used (same values as below)</span></span><br><span class="line"><span class="comment">#  peer:</span></span><br><span class="line"><span class="comment">#    timeout:</span></span><br><span class="line"><span class="comment">#      connection: 10s</span></span><br><span class="line"><span class="comment">#      response: 180s</span></span><br><span class="line"><span class="comment">#      discovery:</span></span><br><span class="line"><span class="comment">#        # Expiry period for discovery service greylist filter</span></span><br><span class="line"><span class="comment">#        # The channel client will greylist peers that are found to be offline</span></span><br><span class="line"><span class="comment">#        # to prevent re-selecting them in subsequent retries.</span></span><br><span class="line"><span class="comment">#        # This interval will define how long a peer is greylisted</span></span><br><span class="line"><span class="comment">#        greylistExpiry: 10s</span></span><br><span class="line"><span class="comment">#  eventService:</span></span><br><span class="line"><span class="comment">#    # Event service type (optional). If not specified then the type is automatically</span></span><br><span class="line"><span class="comment">#    # determined from channel capabilities.</span></span><br><span class="line"><span class="comment">#    type: (deliver|eventhub)</span></span><br><span class="line">    <span class="comment"># the below timeouts are commented out to use the default values that are found in</span></span><br><span class="line">    <span class="comment"># "pkg/fab/endpointconfig.go"</span></span><br><span class="line">    <span class="comment"># the client is free to override the default values by uncommenting and resetting</span></span><br><span class="line">    <span class="comment"># the values as they see fit in their config file</span></span><br><span class="line"><span class="comment">#    timeout:</span></span><br><span class="line"><span class="comment">#      connection: 15s</span></span><br><span class="line"><span class="comment">#      registrationResponse: 15s</span></span><br><span class="line"><span class="comment">#  orderer:</span></span><br><span class="line"><span class="comment">#    timeout:</span></span><br><span class="line"><span class="comment">#      connection: 15s</span></span><br><span class="line"><span class="comment">#      response: 15s</span></span><br><span class="line"><span class="comment">#  global:</span></span><br><span class="line"><span class="comment">#    timeout:</span></span><br><span class="line"><span class="comment">#      query: 180s</span></span><br><span class="line"><span class="comment">#      execute: 180s</span></span><br><span class="line"><span class="comment">#      resmgmt: 180s</span></span><br><span class="line"><span class="comment">#    cache:</span></span><br><span class="line"><span class="comment">#      connectionIdle: 30s</span></span><br><span class="line"><span class="comment">#      eventServiceIdle: 2m</span></span><br><span class="line"><span class="comment">#      channelConfig: 30m</span></span><br><span class="line"><span class="comment">#      channelMembership: 30s</span></span><br><span class="line"><span class="comment">#      discovery: 10s</span></span><br><span class="line"><span class="comment">#      selection: 10m</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Root of the MSP directories with keys and certs.</span></span><br><span class="line">  <span class="attr">cryptoconfig:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">$&#123;GOPATH&#125;/src/github.com/kongyixueyuan.com/kongyixueyuan/fixtures/crypto-config</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Some SDKs support pluggable KV stores, the properties under "credentialStore"</span></span><br><span class="line">  <span class="comment"># are implementation specific</span></span><br><span class="line">  <span class="attr">credentialStore:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/tmp/kongyixueyuan-store</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># [Optional]. Specific to the CryptoSuite implementation used by GO SDK. Software-based implementations</span></span><br><span class="line">    <span class="comment"># requiring a key store. PKCS#11 based implementations does not.</span></span><br><span class="line">    <span class="attr">cryptoStore:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/tmp/kongyixueyuan-msp</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># BCCSP config for the client. Used by GO SDK.</span></span><br><span class="line">  <span class="attr">BCCSP:</span></span><br><span class="line">    <span class="attr">security:</span></span><br><span class="line">     <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">     <span class="attr">default:</span></span><br><span class="line">      <span class="attr">provider:</span> <span class="string">"SW"</span></span><br><span class="line">     <span class="attr">hashAlgorithm:</span> <span class="string">"SHA2"</span></span><br><span class="line">     <span class="attr">softVerify:</span> <span class="literal">true</span></span><br><span class="line">     <span class="attr">level:</span> <span class="number">256</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tlsCerts:</span></span><br><span class="line">    <span class="comment"># [Optional]. Use system certificate pool when connecting to peers, orderers (for negotiating TLS) Default: false</span></span><br><span class="line">    <span class="attr">systemCertPool:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># [Optional]. Client key and cert for TLS handshake with peers and orderers</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">      <span class="attr">key:</span></span><br><span class="line">        <span class="attr">path:</span></span><br><span class="line">      <span class="attr">cert:</span></span><br><span class="line">        <span class="attr">path:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># [Optional]. But most apps would have this section so that channel objects can be constructed</span></span><br><span class="line"><span class="comment"># based on the content below. If an app is creating channels, then it likely will not need this</span></span><br><span class="line"><span class="comment"># section.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">channels:</span></span><br><span class="line">  <span class="comment"># name of the channel</span></span><br><span class="line">  <span class="attr">kevinkongyixueyuan:</span></span><br><span class="line">    <span class="comment"># Required. list of orderers designated by the application to use for transactions on this</span></span><br><span class="line">    <span class="comment"># channel. This list can be a result of access control ("org1" can only access "ordererA"), or</span></span><br><span class="line">    <span class="comment"># operational decisions to share loads from applications among the orderers.  The values must</span></span><br><span class="line">    <span class="comment"># be "names" of orgs defined under "organizations/peers"</span></span><br><span class="line">    <span class="comment"># deprecated: not recommended, to override any orderer configuration items, entity matchers should be used.</span></span><br><span class="line">    <span class="comment"># orderers:</span></span><br><span class="line">    <span class="comment">#  - orderer.kevin.kongyixueyuan.com</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Required. list of peers from participating orgs</span></span><br><span class="line">    <span class="attr">peers:</span></span><br><span class="line">      <span class="attr">peer0.org1.kevin.kongyixueyuan.com:</span></span><br><span class="line">        <span class="comment"># [Optional]. will this peer be sent transaction proposals for endorsement? The peer must</span></span><br><span class="line">        <span class="comment"># have the chaincode installed. The app can also use this property to decide which peers</span></span><br><span class="line">        <span class="comment"># to send the chaincode install request. Default: true</span></span><br><span class="line">        <span class="attr">endorsingPeer:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># [Optional]. will this peer be sent query proposals? The peer must have the chaincode</span></span><br><span class="line">        <span class="comment"># installed. The app can also use this property to decide which peers to send the</span></span><br><span class="line">        <span class="comment"># chaincode install request. Default: true</span></span><br><span class="line">        <span class="attr">chaincodeQuery:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># [Optional]. will this peer be sent query proposals that do not require chaincodes, like</span></span><br><span class="line">        <span class="comment"># queryBlock(), queryTransaction(), etc. Default: true</span></span><br><span class="line">        <span class="attr">ledgerQuery:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># [Optional]. will this peer be the target of the SDK's listener registration? All peers can</span></span><br><span class="line">        <span class="comment"># produce events but the app typically only needs to connect to one to listen to events.</span></span><br><span class="line">        <span class="comment"># Default: true</span></span><br><span class="line">        <span class="attr">eventSource:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">peer1.org1.kevin.kongyixueyuan.com:</span></span><br><span class="line">        <span class="attr">endorsingPeer:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">chaincodeQuery:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">ledgerQuery:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">eventSource:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">policies:</span></span><br><span class="line">      <span class="comment">#[Optional] options for retrieving channel configuration blocks</span></span><br><span class="line">      <span class="attr">queryChannelConfig:</span></span><br><span class="line">        <span class="comment">#[Optional] min number of success responses (from targets/peers)</span></span><br><span class="line">        <span class="attr">minResponses:</span> <span class="number">1</span></span><br><span class="line">        <span class="comment">#[Optional] channel config will be retrieved for these number of random targets</span></span><br><span class="line">        <span class="attr">maxTargets:</span> <span class="number">1</span></span><br><span class="line">        <span class="comment">#[Optional] retry options for query config block</span></span><br><span class="line">        <span class="attr">retryOpts:</span></span><br><span class="line">          <span class="comment">#[Optional] number of retry attempts</span></span><br><span class="line">          <span class="attr">attempts:</span> <span class="number">5</span></span><br><span class="line">          <span class="comment">#[Optional] the back off interval for the first retry attempt</span></span><br><span class="line">          <span class="attr">initialBackoff:</span> <span class="string">500ms</span></span><br><span class="line">          <span class="comment">#[Optional] the maximum back off interval for any retry attempt</span></span><br><span class="line">          <span class="attr">maxBackoff:</span> <span class="string">5s</span></span><br><span class="line">          <span class="comment">#[Optional] he factor by which the initial back off period is exponentially incremented</span></span><br><span class="line">          <span class="attr">backoffFactor:</span> <span class="number">2.0</span></span><br><span class="line">      <span class="comment">#[Optional] options for retrieving discovery info</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment">#[Optional] discovery info will be retrieved for these number of random targets</span></span><br><span class="line">        <span class="attr">maxTargets:</span> <span class="number">2</span></span><br><span class="line">        <span class="comment">#[Optional] retry options for retrieving discovery info</span></span><br><span class="line">        <span class="attr">retryOpts:</span></span><br><span class="line">          <span class="comment">#[Optional] number of retry attempts</span></span><br><span class="line">          <span class="attr">attempts:</span> <span class="number">4</span></span><br><span class="line">          <span class="comment">#[Optional] the back off interval for the first retry attempt</span></span><br><span class="line">          <span class="attr">initialBackoff:</span> <span class="string">500ms</span></span><br><span class="line">          <span class="comment">#[Optional] the maximum back off interval for any retry attempt</span></span><br><span class="line">          <span class="attr">maxBackoff:</span> <span class="string">5s</span></span><br><span class="line">          <span class="comment">#[Optional] he factor by which the initial back off period is exponentially incremented</span></span><br><span class="line">          <span class="attr">backoffFactor:</span> <span class="number">2.0</span></span><br><span class="line">      <span class="comment">#[Optional] options for the event service</span></span><br><span class="line">      <span class="attr">eventService:</span></span><br><span class="line">        <span class="comment"># [Optional] resolverStrategy specifies the peer resolver strategy to use when connecting to a peer</span></span><br><span class="line">        <span class="comment"># Possible values: [PreferOrg (default), MinBlockHeight, Balanced]</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># PreferOrg:</span></span><br><span class="line">        <span class="comment">#   Determines which peers are suitable based on block height lag threshold, although will prefer the peers in the</span></span><br><span class="line">        <span class="comment">#   current org (as long as their block height is above a configured threshold). If none of the peers from the current org</span></span><br><span class="line">        <span class="comment">#   are suitable then a peer from another org is chosen.</span></span><br><span class="line">        <span class="comment"># MinBlockHeight:</span></span><br><span class="line">        <span class="comment">#   Chooses the best peer according to a block height lag threshold. The maximum block height of all peers is</span></span><br><span class="line">        <span class="comment">#   determined and the peers whose block heights are under the maximum height but above a provided "lag" threshold are load</span></span><br><span class="line">        <span class="comment">#   balanced. The other peers are not considered.</span></span><br><span class="line">        <span class="comment"># Balanced:</span></span><br><span class="line">        <span class="comment">#   Chooses peers using the configured balancer.</span></span><br><span class="line">        <span class="attr">resolverStrategy:</span> <span class="string">PreferOrg</span></span><br><span class="line">        <span class="comment"># [Optional] balancer is the balancer to use when choosing a peer to connect to</span></span><br><span class="line">        <span class="comment"># Possible values: [Random (default), RoundRobin]</span></span><br><span class="line">        <span class="attr">balancer:</span> <span class="string">Random</span></span><br><span class="line">        <span class="comment"># [Optional] blockHeightLagThreshold sets the block height lag threshold. This value is used for choosing a peer</span></span><br><span class="line">        <span class="comment"># to connect to. If a peer is lagging behind the most up-to-date peer by more than the given number of</span></span><br><span class="line">        <span class="comment"># blocks then it will be excluded from selection.</span></span><br><span class="line">        <span class="comment"># If set to 0 then only the most up-to-date peers are considered.</span></span><br><span class="line">        <span class="comment"># If set to -1 then all peers (regardless of block height) are considered for selection.</span></span><br><span class="line">        <span class="comment"># Default: 5</span></span><br><span class="line">        <span class="attr">blockHeightLagThreshold:</span> <span class="number">5</span></span><br><span class="line">        <span class="comment"># [Optional] reconnectBlockHeightLagThreshold - if &gt;0 then the event client will disconnect from the peer if the peer's</span></span><br><span class="line">        <span class="comment"># block height falls behind the specified number of blocks and will reconnect to a better performing peer.</span></span><br><span class="line">        <span class="comment"># If set to 0 then this feature is disabled.</span></span><br><span class="line">        <span class="comment"># Default: 10</span></span><br><span class="line">        <span class="comment"># NOTES:</span></span><br><span class="line">        <span class="comment">#   - peerMonitorPeriod must be &gt;0 to enable this feature</span></span><br><span class="line">        <span class="comment">#   - Setting this value too low may cause the event client to disconnect/reconnect too frequently, thereby</span></span><br><span class="line">        <span class="comment">#     affecting performance.</span></span><br><span class="line">        <span class="attr">reconnectBlockHeightLagThreshold:</span> <span class="number">10</span></span><br><span class="line">        <span class="comment"># [Optional] peerMonitorPeriod is the period in which the connected peer is monitored to see if</span></span><br><span class="line">        <span class="comment"># the event client should disconnect from it and reconnect to another peer.</span></span><br><span class="line">        <span class="comment"># Default: 0 (disabled)</span></span><br><span class="line">        <span class="attr">peerMonitorPeriod:</span> <span class="string">5s</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># list of participating organizations in this network</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">organizations:</span></span><br><span class="line">  <span class="attr">Org1:</span></span><br><span class="line">    <span class="attr">mspid:</span> <span class="string">org1.kevin.kongyixueyuan.com</span></span><br><span class="line">    <span class="attr">cryptoPath:</span> <span class="string">peerOrganizations/org1.kevin.kongyixueyuan.com/users/&#123;userName&#125;@org1.kevin.kongyixueyuan.com/msp</span></span><br><span class="line">    <span class="attr">peers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">peer0.org1.kevin.kongyixueyuan.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">peer1.org1.kevin.kongyixueyuan.com</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># [Optional]. Certificate Authorities issue certificates for identification purposes in a Fabric based</span></span><br><span class="line">    <span class="comment"># network. Typically certificates provisioning is done in a separate process outside of the</span></span><br><span class="line">    <span class="comment"># runtime network. Fabric-CA is a special certificate authority that provides a REST APIs for</span></span><br><span class="line">    <span class="comment"># dynamic certificate management (enroll, revoke, re-enroll). The following section is only for</span></span><br><span class="line">    <span class="comment"># Fabric-CA servers.</span></span><br><span class="line">    <span class="attr">certificateAuthorities:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ca.org1.kevin.kongyixueyuan.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># List of orderers to send transaction and channel create/update requests to. For the time</span></span><br><span class="line"><span class="comment"># being only one orderer is needed. If more than one is defined, which one get used by the</span></span><br><span class="line"><span class="comment"># SDK is implementation specific. Consult each SDK's documentation for its handling of orderers.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">orderers:</span></span><br><span class="line">  <span class="attr">orderer.kevin.kongyixueyuan.com:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">localhost:7050</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># these are standard properties defined by the gRPC library</span></span><br><span class="line">    <span class="comment"># they will be passed in as-is to gRPC client constructor</span></span><br><span class="line">    <span class="attr">grpcOptions:</span></span><br><span class="line">      <span class="attr">ssl-target-name-override:</span> <span class="string">orderer.kevin.kongyixueyuan.com</span></span><br><span class="line">      <span class="comment"># These parameters should be set in coordination with the keepalive policy on the server,</span></span><br><span class="line">      <span class="comment"># as incompatible settings can result in closing of connection.</span></span><br><span class="line">      <span class="comment"># When duration of the 'keep-alive-time' is set to 0 or less the keep alive client parameters are disabled</span></span><br><span class="line">      <span class="attr">keep-alive-time:</span> <span class="string">0s</span></span><br><span class="line">      <span class="attr">keep-alive-timeout:</span> <span class="string">20s</span></span><br><span class="line">      <span class="attr">keep-alive-permit:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">fail-fast:</span> <span class="literal">false</span></span><br><span class="line">      <span class="comment"># allow-insecure will be taken into consideration if address has no protocol defined, if true then grpc or else grpcs</span></span><br><span class="line">      <span class="attr">allow-insecure:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">tlsCACerts:</span></span><br><span class="line">      <span class="comment"># Certificate location absolute path</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">$&#123;GOPATH&#125;/src/github.com/kongyixueyuan.com/kongyixueyuan/fixtures/crypto-config/ordererOrganizations/kevin.kongyixueyuan.com/tlsca/tlsca.kevin.kongyixueyuan.com-cert.pem</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># List of peers to send various requests to, including endorsement, query</span></span><br><span class="line"><span class="comment"># and event listener registration.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">peers:</span></span><br><span class="line">  <span class="attr">peer0.org1.kevin.kongyixueyuan.com:</span></span><br><span class="line">    <span class="comment"># this URL is used to send endorsement and query requests</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">localhost:7051</span></span><br><span class="line">    <span class="comment"># eventUrl is only needed when using eventhub (default is delivery service)</span></span><br><span class="line">    <span class="attr">eventUrl:</span> <span class="string">localhost:7053</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">grpcOptions:</span></span><br><span class="line">      <span class="attr">ssl-target-name-override:</span> <span class="string">peer0.org1.kevin.kongyixueyuan.com</span></span><br><span class="line">      <span class="comment"># These parameters should be set in coordination with the keepalive policy on the server,</span></span><br><span class="line">      <span class="comment"># as incompatible settings can result in closing of connection.</span></span><br><span class="line">      <span class="comment"># When duration of the 'keep-alive-time' is set to 0 or less the keep alive client parameters are disabled</span></span><br><span class="line">      <span class="attr">keep-alive-time:</span> <span class="string">0s</span></span><br><span class="line">      <span class="attr">keep-alive-timeout:</span> <span class="string">20s</span></span><br><span class="line">      <span class="attr">keep-alive-permit:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">fail-fast:</span> <span class="literal">false</span></span><br><span class="line">      <span class="comment"># allow-insecure will be taken into consideration if address has no protocol defined, if true then grpc or else grpcs</span></span><br><span class="line">      <span class="attr">allow-insecure:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">tlsCACerts:</span></span><br><span class="line">      <span class="comment"># Certificate location absolute path</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">$&#123;GOPATH&#125;/src/github.com/kongyixueyuan.com/kongyixueyuan/fixtures/crypto-config/peerOrganizations/org1.kevin.kongyixueyuan.com/tlsca/tlsca.org1.kevin.kongyixueyuan.com-cert.pem</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer1.org1.kevin.kongyixueyuan.com:</span></span><br><span class="line">    <span class="comment"># this URL is used to send endorsement and query requests</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">localhost:7151</span></span><br><span class="line">    <span class="comment"># eventUrl is only needed when using eventhub (default is delivery service)</span></span><br><span class="line">    <span class="attr">eventUrl:</span> <span class="string">localhost:7153</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">grpcOptions:</span></span><br><span class="line">      <span class="attr">ssl-target-name-override:</span> <span class="string">peer1.org1.kevin.kongyixueyuan.com</span></span><br><span class="line">      <span class="comment"># These parameters should be set in coordination with the keepalive policy on the server,</span></span><br><span class="line">      <span class="comment"># as incompatible settings can result in closing of connection.</span></span><br><span class="line">      <span class="comment"># When duration of the 'keep-alive-time' is set to 0 or less the keep alive client parameters are disabled</span></span><br><span class="line">      <span class="attr">keep-alive-time:</span> <span class="string">0s</span></span><br><span class="line">      <span class="attr">keep-alive-timeout:</span> <span class="string">20s</span></span><br><span class="line">      <span class="attr">keep-alive-permit:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">fail-fast:</span> <span class="literal">false</span></span><br><span class="line">      <span class="comment"># allow-insecure will be taken into consideration if address has no protocol defined, if true then grpc or else grpcs</span></span><br><span class="line">      <span class="attr">allow-insecure:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">tlsCACerts:</span></span><br><span class="line">      <span class="comment"># Certificate location absolute path</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">$&#123;GOPATH&#125;/src/github.com/kongyixueyuan.com/kongyixueyuan/fixtures/crypto-config/peerOrganizations/org1.kevin.kongyixueyuan.com/tlsca/tlsca.org1.kevin.kongyixueyuan.com-cert.pem</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Fabric-CA is a special kind of Certificate Authority provided by Hyperledger Fabric which allows</span></span><br><span class="line"><span class="comment"># certificate management to be done via REST APIs. Application may choose to use a standard</span></span><br><span class="line"><span class="comment"># Certificate Authority instead of Fabric-CA, in which case this section would not be specified.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">certificateAuthorities:</span></span><br><span class="line">  <span class="attr">ca.org1.kevin.kongyixueyuan.com:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://localhost:7054</span></span><br><span class="line">    <span class="attr">tlsCACerts:</span></span><br><span class="line">      <span class="comment"># Certificate location absolute path</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">$&#123;GOPATH&#125;/src/github.com/kongyixueyuan.com/kongyixueyuan/fixtures/crypto-config/peerOrganizations/org1.kevin.kongyixueyuan.com/ca/ca.org1.kevin.kongyixueyuan.com-cert.pem</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Fabric-CA supports dynamic user enrollment via REST APIs. A "root" user, a.k.a registrar, is</span></span><br><span class="line">    <span class="comment"># needed to enroll and invoke new users.</span></span><br><span class="line">    <span class="attr">registrar:</span></span><br><span class="line">      <span class="attr">enrollId:</span> <span class="string">admin</span></span><br><span class="line">      <span class="attr">enrollSecret:</span> <span class="string">adminpw</span></span><br><span class="line">    <span class="comment"># [Optional] The optional name of the CA.</span></span><br><span class="line">    <span class="attr">caName:</span> <span class="string">ca.org1.kevin.kongyixueyuan.com</span></span><br><span class="line"></span><br><span class="line"><span class="attr">entityMatchers:</span></span><br><span class="line">  <span class="attr">peer:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">pattern:</span> <span class="string">(\w*)peer0.org1.kevin.kongyixueyuan.com(\w*)</span></span><br><span class="line">      <span class="attr">urlSubstitutionExp:</span> <span class="string">localhost:7051</span></span><br><span class="line">      <span class="attr">eventUrlSubstitutionExp:</span> <span class="string">localhost:7053</span></span><br><span class="line">      <span class="attr">sslTargetOverrideUrlSubstitutionExp:</span> <span class="string">peer0.org1.kevin.kongyixueyuan.com</span></span><br><span class="line">      <span class="attr">mappedHost:</span> <span class="string">peer0.org1.kevin.kongyixueyuan.com</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">pattern:</span> <span class="string">(\w*)peer1.org1.kevin.kongyixueyuan.com(\w*)</span></span><br><span class="line">      <span class="attr">urlSubstitutionExp:</span> <span class="string">localhost:7151</span></span><br><span class="line">      <span class="attr">eventUrlSubstitutionExp:</span> <span class="string">localhost:7153</span></span><br><span class="line">      <span class="attr">sslTargetOverrideUrlSubstitutionExp:</span> <span class="string">peer1.org1.kevin.kongyixueyuan.com</span></span><br><span class="line">      <span class="attr">mappedHost:</span> <span class="string">peer1.org1.kevin.kongyixueyuan.com</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">orderer:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">pattern:</span> <span class="string">(\w*)orderer.kevin.kongyixueyuan.com(\w*)</span></span><br><span class="line">      <span class="attr">urlSubstitutionExp:</span> <span class="string">localhost:7050</span></span><br><span class="line">      <span class="attr">sslTargetOverrideUrlSubstitutionExp:</span> <span class="string">orderer.kevin.kongyixueyuan.com</span></span><br><span class="line">      <span class="attr">mappedHost:</span> <span class="string">orderer.kevin.kongyixueyuan.com</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">certificateAuthorities:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">pattern:</span> <span class="string">(\w*)ca.org1.kevin.kongyixueyuan.com(\w*)</span></span><br><span class="line">      <span class="attr">urlSubstitutionExp:</span> <span class="string">http://localhost:7054</span></span><br><span class="line">      <span class="attr">mappedHost:</span> <span class="string">ca.org1.kevin.kongyixueyuan.com</span></span><br></pre></td></tr></table></figure>

<h3 id="2-定义所需结构体"><a href="#2-定义所需结构体" class="headerlink" title="2 定义所需结构体"></a>2 定义所需结构体</h3><p>配置文件完成指定的配置信息之后，我们开始编写代码。</p>
<p>在项目的根目录下添加一个名为 <code>sdkInit</code> 的新目录，我们将在这个文件夹中创建 SDK，并根据配置信息创建应用通道</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir sdkInit</span></span><br></pre></td></tr></table></figure>

<p>为了方便管理 Hyperledger Fabric 网络环境，我们将在 <code>sdkInit</code> 目录中创建一个 <code>fabricInitInfo.go</code> 的源代码文件，用于定义一个结构体，包括 Fabric SDK 所需的各项相关信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim sdkInit/fabricInitInfo.go</span></span><br></pre></td></tr></table></figure>

<p><code>fabricInitInfo.go</code> 源代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  author: hanxiaodong</span></span><br><span class="line"><span class="comment">  QQ群（专业Fabric交流群）：862733552</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> sdkInit</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/hyperledger/fabric-sdk-go/pkg/client/resmgmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> InitInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">    ChannelID     <span class="keyword">string</span></span><br><span class="line">    ChannelConfig <span class="keyword">string</span></span><br><span class="line">    OrgName      <span class="keyword">string</span></span><br><span class="line">    OrgAdmin       <span class="keyword">string</span></span><br><span class="line">    OrdererOrgName    <span class="keyword">string</span></span><br><span class="line">    OrgResMgmt *resmgmt.Client</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结构体中包含成员解释如下：</p>
<ul>
<li><strong>ChannelID：</strong>通道名称</li>
<li><strong>ChannelConfig：</strong>通道交易配置文件所在路径</li>
<li><strong>OrgName：</strong>组织名称</li>
<li><strong>OrgAdmin：</strong>组织管理员名称</li>
<li><strong>OrdererOrgName：</strong>Orderer名称</li>
<li><strong>OrgResMgmt：</strong>资源管理端实例</li>
</ul>
<p>声明好结构体中的相应成员之后，就可以使用 <code>fabric-sdk-go</code> 相关的API来创建SDK实例，并使用该SDK实例进行一系列的操作，如：</p>
<ul>
<li>创建通道</li>
<li>将组织中的peers加入已创建的通道中</li>
<li>安装链码</li>
<li>实例化链码</li>
<li>创建客户端实例</li>
</ul>
<h3 id="3-创建SDK"><a href="#3-创建SDK" class="headerlink" title="3 创建SDK"></a>3 创建SDK</h3><p>首先，我们先来完成SDK的创建及通道的创建，通道创建完成之后，就可以将peers加入到该通道中。</p>
<p>在 <code>sdkInit</code> 目录下新创建一个名为 <code>start.go</code> 的源代码文件利用 vim 编辑器进行编辑：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim sdkInit/start.go</span></span><br></pre></td></tr></table></figure>

<p><code>start.go</code> 的完整代码如下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  author: hanxiaodong</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> sdkInit</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/hyperledger/fabric-sdk-go/pkg/fabsdk"</span></span><br><span class="line">    <span class="string">"github.com/hyperledger/fabric-sdk-go/pkg/core/config"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"github.com/hyperledger/fabric-sdk-go/pkg/client/resmgmt"</span></span><br><span class="line">    mspclient <span class="string">"github.com/hyperledger/fabric-sdk-go/pkg/client/msp"</span></span><br><span class="line">    <span class="string">"github.com/hyperledger/fabric-sdk-go/pkg/common/providers/msp"</span></span><br><span class="line">    <span class="string">"github.com/hyperledger/fabric-sdk-go/pkg/common/errors/retry"</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ChaincodeVersion  = <span class="string">"1.0"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetupSDK</span><span class="params">(ConfigFile <span class="keyword">string</span>, initialized <span class="keyword">bool</span>)</span> <span class="params">(*fabsdk.FabricSDK, error)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> initialized &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"Fabric SDK已被实例化"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sdk, err := fabsdk.New(config.FromFile(ConfigFile))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"实例化Fabric SDK失败: %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"Fabric SDK初始化成功"</span>)</span><br><span class="line">    <span class="keyword">return</span> sdk, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CreateChannel</span><span class="params">(sdk *fabsdk.FabricSDK, info *InitInfo)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    clientContext := sdk.Context(fabsdk.WithUser(info.OrgAdmin), fabsdk.WithOrg(info.OrgName))</span><br><span class="line">    <span class="keyword">if</span> clientContext == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"根据指定的组织名称与管理员创建资源管理客户端Context失败"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// New returns a resource management client instance.</span></span><br><span class="line">    resMgmtClient, err := resmgmt.New(clientContext)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"根据指定的资源管理客户端Context创建通道管理客户端失败: %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// New creates a new Client instance</span></span><br><span class="line">    mspClient, err := mspclient.New(sdk.Context(), mspclient.WithOrg(info.OrgName))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"根据指定的 OrgName 创建 Org MSP 客户端实例失败: %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  Returns: signing identity</span></span><br><span class="line">    adminIdentity, err := mspClient.GetSigningIdentity(info.OrgAdmin)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"获取指定id的签名标识失败: %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SaveChannelRequest holds parameters for save channel request</span></span><br><span class="line">    channelReq := resmgmt.SaveChannelRequest&#123;ChannelID:info.ChannelID, ChannelConfigPath:info.ChannelConfig, SigningIdentities:[]msp.SigningIdentity&#123;adminIdentity&#125;&#125;</span><br><span class="line">    <span class="comment">// save channel response with transaction ID</span></span><br><span class="line">     _, err = resMgmtClient.SaveChannel(channelReq, resmgmt.WithRetry(retry.DefaultResMgmtOpts), resmgmt.WithOrdererEndpoint(info.OrdererOrgName))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"创建应用通道失败: %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"通道已成功创建，"</span>)</span><br><span class="line"></span><br><span class="line">    info.OrgResMgmt = resMgmtClient</span><br><span class="line"></span><br><span class="line">    <span class="comment">// allows for peers to join existing channel with optional custom options (specific peers, filtered peers). If peer(s) are not specified in options it will default to all peers that belong to client's MSP.</span></span><br><span class="line">    err = info.OrgResMgmt.JoinChannel(info.ChannelID, resmgmt.WithRetry(retry.DefaultResMgmtOpts), resmgmt.WithOrdererEndpoint(info.OrdererOrgName))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"Peers加入通道失败: %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"peers 已成功加入通道."</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-编写测试代码"><a href="#4-编写测试代码" class="headerlink" title="4 编写测试代码"></a>4 编写测试代码</h3><p>为了确保客户端能够初始化所有组件，将在启动网络的情况下进行简单的测试。 为了做到这一点，我们需要编写 Go 代码，在项目根目录下新创建一个 <code>main.go</code> 的主文件并编辑内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/kongyixueyuan.com/kongyixueyuan</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim main.go</span></span><br></pre></td></tr></table></figure>

<p><code>main.go</code> 文件完整源代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  author: hg</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"github.com/kongyixueyuan.com/kongyixueyuan/sdkInit"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    configFile = <span class="string">"config.yaml"</span></span><br><span class="line">    initialized = <span class="literal">false</span></span><br><span class="line">    SimpleCC = <span class="string">"simplecc"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    initInfo := &amp;sdkInit.InitInfo&#123;</span><br><span class="line"></span><br><span class="line">        ChannelID: <span class="string">"kevinkongyixueyuan"</span>,</span><br><span class="line">        ChannelConfig: os.Getenv(<span class="string">"GOPATH"</span>) + <span class="string">"/src/github.com/kongyixueyuan.com/kongyixueyuan/fixtures/artifacts/channel.tx"</span>,</span><br><span class="line"></span><br><span class="line">        OrgAdmin:<span class="string">"Admin"</span>,</span><br><span class="line">        OrgName:<span class="string">"Org1"</span>,</span><br><span class="line">        OrdererOrgName: <span class="string">"orderer.kevin.kongyixueyuan.com"</span>,</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sdk, err := sdkInit.SetupSDK(configFile, initialized)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(err.Error())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> sdk.Close()</span><br><span class="line"></span><br><span class="line">    err = sdkInit.CreateChannel(sdk, initInfo)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err.Error())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、满足依赖"><a href="#二、满足依赖" class="headerlink" title="二、满足依赖"></a>二、满足依赖</h2><h4 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h4><ol>
<li>根据项目要求满足所需依赖</li>
<li>使用Makefiel简化项目测试</li>
</ol>
<h3 id="1-安装dep工具"><a href="#1-安装dep工具" class="headerlink" title="1 安装dep工具"></a>1 安装dep工具</h3><p>在运行应用程序之前，需要将 Go 源代码时行编译，但在开始编译之前，我们需要使用一个 <code>vendor</code> 目录来包含应用中所需的所有的依赖关系。 在我们的GOPATH中，我们有Fabric SDK Go和其他项目。 在尝试编译应用程序时，Golang 会在 GOPATH 中搜索依赖项，但首先会检查项目中是否存在<code>vendor</code> 文件夹。 如果项目中包含一个叫vendor的目录，Golang 将会从这个目录搜索依赖的包，就不会去检查 GOPATH 或 GOROOT。</p>
<p>Golang官方最初只提供了包管理的 <code>go get</code> 工具，它将下载的第三方包放到GOPATH的src目录下。但是项目一般由许多来源不同的第三包构成，所以在Golang1.5版本增加了一个新的发现包的方法，通过使用像<a href="https://translate.googleusercontent.com/translate_c?depth=1&hl=zh-CN&rurl=translate.google.com&sl=en&sp=nmt4&tl=zh-CN&u=https://github.com/golang/dep&xid=25657,15700002,15700019,15700124,15700149,15700168,15700186,15700201&usg=ALkJrhgelyRl7D3pIJRpuA8cynagkWYHXg" target="_blank" rel="noopener"><code>dep</code></a>这样的工具在<code>vendor</code>目录中来处理这些依赖关系。</p>
<p>将如下环境变量设置到用户的环境文件中(.bashrc)中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim ~/.bashrc</span></span><br><span class="line"></span><br><span class="line">export PATH=$PATH:$GOPATH/bin</span><br></pre></td></tr></table></figure>

<p>执行 <code>source</code> 命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> ~/.bashrc</span></span><br></pre></td></tr></table></figure>

<p>在Golang的新版本中没有自动加入 <code>dep</code> 工具，所以需要开发人员自行安装该工具。</p>
<p>安装 dep 工具</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go get -u github.com/golang/dep</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> go get -u github.com/golang/dep/cmd/dep //下载不下来</span></span><br></pre></td></tr></table></figure>

<h3 id="2-下载所需依赖"><a href="#2-下载所需依赖" class="headerlink" title="2 下载所需依赖"></a>2 下载所需依赖</h3><p><code>dep</code> 工具安装好之后我们来安装应用所需要的依赖</p>
<p>使用 <code>dep</code> 命令需要一个名为 <code>Gopkg.toml</code> 的配置文件指定依赖信息</p>
<p>创建一个名为<code>Gopkg.toml</code>的文件并编辑：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim Gopkg.toml</span></span><br></pre></td></tr></table></figure>

<p><code>Gopkg.toml</code>文件中添加如下内容：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ignored</span> = [<span class="string">"github.com/kongyixueyuan.com/kongyixueyuan/chaincode"</span>]</span><br><span class="line"></span><br><span class="line">[[constraint]]  //这里我还成了[[override]]</span><br><span class="line">  <span class="comment"># Release v1.0.0-alpha4</span></span><br><span class="line">  name = "github.com/hyperledger/fabric-sdk-go"</span><br><span class="line">  revision = "a906355f73d060d7bf95874a9e90dc17589edbb3"</span><br></pre></td></tr></table></figure>

<p>使用<code>dep</code>限制在 vendor 中指定希望SDK的特定版本。</p>
<p>保存该文件，然后执行 <code>dep ensure</code> 命令，该命令会自动将项目所需的依赖下载至当前的 <code>vendor</code> 目录中（下载依赖可能需要一段时间）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> dep ensure</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>提醒：<code>dep ensure</code> 命令执行由于时间比较长，所以执行一次后即可，在后面的Makefile中可注释<code>@dep ensure</code>命令。</p>
</blockquote>
<h3 id="3-测试Fabric-SDK"><a href="#3-测试Fabric-SDK" class="headerlink" title="3 测试Fabric-SDK"></a>3 测试Fabric-SDK</h3><p>所在依赖下载安装完成后，我们就可以进行测试</p>
<p>首先启动网络：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> fixtures</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker-compose up -d</span></span><br></pre></td></tr></table></figure>

<p>然后编译并运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ..</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> go build</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./kongyixueyuan</span></span><br></pre></td></tr></table></figure>

<p>命令执行后输出结果如下图所示：</p>
<p><img src="http://image.chaindesk.cn/11.1_5.png/mark" alt="创建通道并加入指定的Peers"></p>
<p>如果出现上图的输出结果，则说明执行成功，否则需要根据出现的错误提示进行相应的处理。</p>
<h3 id="4-关闭网络并清理环境"><a href="#4-关闭网络并清理环境" class="headerlink" title="4 关闭网络并清理环境"></a>4 关闭网络并清理环境</h3><p>测试成功之后即可以关闭Hypledger Fabric网络，但是我们在Fabric-SDK的配置文件config.yaml中指定了生成的密钥、证书的存储路径，关闭网络之后需要将其进行清理。</p>
<p>1）首先关闭处于启动状态的网络环境：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/kongyixueyuan.com/kongyixueyuan/fixtures </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker-compose down</span></span><br></pre></td></tr></table></figure>

<p>2）然后删除证书存储（由config.yaml配置文件中的client.credentialStore定义）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rm -rf /tmp/kongyixueyuan-*</span></span><br></pre></td></tr></table></figure>

<p>3）最后删除一些不是由docker-compose命令生成的docker容器和docker镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker rm -f -v `docker ps -a --no-trunc | grep <span class="string">"kongyixueyuan"</span> | cut -d <span class="string">' '</span> -f 1` 2&gt;/dev/null</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker rmi `docker images --no-trunc | grep <span class="string">"kongyixueyuan"</span> | cut -d <span class="string">' '</span> -f 1` 2&gt;/dev/null</span></span><br></pre></td></tr></table></figure>

<h3 id="5-利用Makefile简化步骤"><a href="#5-利用Makefile简化步骤" class="headerlink" title="5 利用Makefile简化步骤"></a>5 利用Makefile简化步骤</h3><p>由上面的步骤大家可以看出，启动网络及关闭并清理环境需要执行很多的命令（如进入目录、启动网络、构建、关闭网络、清理环境等等），为了方便测试，用一种方式来简化每次操作时的步骤，我们可以使用一个名为make的工具来实现，该工具的命令可以在一个步骤中自动完成所有的操作执行任务。具体实现方式如下：</p>
<p>创建一个Makefile 文件。 首先，确保你的系统中已经安装了 make 工具。使用如下命令检测是否已安装make工具：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> make --version</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果没有 <code>make</code> 工具（Ubuntu），则需要先安装 <code>make</code> ：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt install make</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>然后进入到项目的根目录下并创建一个名为 <code>Makefile</code> 的文件进行编辑：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/kongyixueyuan.com/kongyixueyuan</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim Makefile</span></span><br></pre></td></tr></table></figure>

<p>在创建的 <code>Makefile</code> 文件中添加如下内容：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: all dev clean build env-up env-down run</span></span><br><span class="line"></span><br><span class="line"><span class="section">all: clean build env-up run</span></span><br><span class="line"></span><br><span class="line"><span class="section">dev: build run</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##### BUILD</span></span><br><span class="line"><span class="section">build:</span></span><br><span class="line">    @echo <span class="string">"Build ..."</span></span><br><span class="line">    @dep ensure</span><br><span class="line">    @go build</span><br><span class="line">    @echo <span class="string">"Build done"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##### ENV</span></span><br><span class="line"><span class="section">env-up:</span></span><br><span class="line">    @echo <span class="string">"Start environment ..."</span></span><br><span class="line">    @cd fixtures &amp;&amp; docker-compose up --force-recreate -d</span><br><span class="line">    @echo <span class="string">"Environment up"</span></span><br><span class="line"></span><br><span class="line"><span class="section">env-down:</span></span><br><span class="line">    @echo <span class="string">"Stop environment ..."</span></span><br><span class="line">    @cd fixtures &amp;&amp; docker-compose down</span><br><span class="line">    @echo <span class="string">"Environment down"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##### RUN</span></span><br><span class="line"><span class="section">run:</span></span><br><span class="line">    @echo <span class="string">"Start app ..."</span></span><br><span class="line">    @./kongyixueyuan</span><br><span class="line"></span><br><span class="line"><span class="comment">##### CLEAN</span></span><br><span class="line"><span class="section">clean: env-down</span></span><br><span class="line">    @echo <span class="string">"Clean up ..."</span></span><br><span class="line">    @rm -rf /tmp/kongyixueyuan-* kongyixueyuan</span><br><span class="line">    @docker rm -f -v `docker ps -a --no-trunc | grep <span class="string">"kongyixueyuan"</span> | cut -d ' ' -f 1` 2&gt;/dev/null || true</span><br><span class="line">    @docker rmi `docker images --no-trunc | grep <span class="string">"kongyixueyuan"</span> | cut -d ' ' -f 1` 2&gt;/dev/null || true</span><br><span class="line">    @echo <span class="string">"Clean up done"</span></span><br></pre></td></tr></table></figure>

<p>定义的Makefile文件可以执行完成如下步骤的任务：</p>
<p>1）使用make clean命令将关闭并清理Hyperledger Fabric整个网络环境；</p>
<p>2）使用make build命令将编译Golang应用程序；</p>
<p>3）使用make env-up命令将启动 Hyperledger Fabric网络环境；</p>
<p>4）使用make clean命令将启动应用程序并运行。</p>
<p>如果想直接启动项目，则可以使用 make 命令。该 make 命令执行顺序如上面的步骤所示。</p>
<h4 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h4><ol>
<li><p>Gopkg.toml 到底是一个什么文件？</p>
<p>Gopkg.toml 文件是 dep 工具的文件，它包含了dep 的几种类型限制规则，详情请参见：</p>
<p><a href="https://github.com/golang/dep/blob/master/docs/Gopkg.toml.md" target="_blank" rel="noopener">https://github.com/golang/dep/blob/master/docs/Gopkg.toml.md</a></p>
</li>
<li><p>Makefile文件起什么作用？</p>
<p>有的项目/系统在编写好源代码之后，编译、启动之前需要做大量的前期工作，而这些工作如果使用手动方式来实现，效率非常低下，这时就可以考虑使用 Linux 操作系统中的 make 命令来实现，只需要将其内容写在一个名为Mackfile的文件中，就可以实现自动化操作，提高开发及测试效率。Makefile可以看作是一个 Shell 脚本，主要用于指定整个项目的编译、启动规则（顺序），在编译之前先做什么事情，编译之后启动之前做什么。</p>
</li>
</ol>
<h2 id="三、链码实现"><a href="#三、链码实现" class="headerlink" title="三、链码实现"></a>三、链码实现</h2><h4 id="目标-2"><a href="#目标-2" class="headerlink" title="目标"></a>目标</h4><ol>
<li>实现链代码</li>
</ol>
<h4 id="任务实现-1"><a href="#任务实现-1" class="headerlink" title="任务实现"></a>任务实现</h4><p>为了便于测试及简化代码，我们实现一个简单的链码功能，能够实现对分类账本中的数据进行设置（PutState（k，v））及相应的查询（GetState（k））功能即可。</p>
<h3 id="1-编写链码"><a href="#1-编写链码" class="headerlink" title="1 编写链码"></a>1 编写链码</h3><p>在当前项目根目录中创建一个存放链码文件的 <code>chaincode</code> 目录，然后在该目录下创建一个 <code>main.go</code> 的文件并对其进行编辑</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir chaincode</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim chaincode/main.go</span></span><br></pre></td></tr></table></figure>

<p>编写链码必须遵守链码开发的相关规定（详见第五章链码开发的相关内容），为此我们在链码文件中声明5个函数，如下：</p>
<ul>
<li><strong>Init(stub shim.ChaincodeStubInterface) ：</strong>初始化链码或升级链码时被调用的函数</li>
<li><strong>Invoke(stub shim.ChaincodeStubInterface)：</strong>查询或更新操作分类账本状态时被调用的函数</li>
<li><strong>set(stub shim.ChaincodeStubInterface, args []string)：</strong>根据用户指定的Key与Value更新分类账本中的状态</li>
<li><strong>get(stub shim.ChaincodeStubInterface, args []string)：</strong>根据用户指定的Key从分类账本中查询状态</li>
<li><strong>main()：</strong>启动链码的主函数</li>
</ul>
<p><code>main.go</code> 文件内容如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  author: hanxiaodong</span></span><br><span class="line"><span class="comment">  QQ群（专业Fabric交流群）：862733552</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/hyperledger/fabric/core/chaincode/shim"</span></span><br><span class="line">    <span class="string">"github.com/hyperledger/fabric/protos/peer"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SimpleChaincode <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *SimpleChaincode)</span> <span class="title">Init</span><span class="params">(stub shim.ChaincodeStubInterface)</span> <span class="title">peer</span>.<span class="title">Response</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> shim.Success(<span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *SimpleChaincode)</span> <span class="title">Invoke</span><span class="params">(stub shim.ChaincodeStubInterface)</span> <span class="title">peer</span>.<span class="title">Response</span></span>&#123;</span><br><span class="line">    fun, args := stub.GetFunctionAndParameters()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">var</span> err error</span><br><span class="line">    <span class="keyword">if</span> fun == <span class="string">"set"</span>&#123;</span><br><span class="line">        result, err = set(stub, args)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        result, err = get(stub, args)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shim.Error(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> shim.Success([]<span class="keyword">byte</span>(result))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">set</span><span class="params">(stub shim.ChaincodeStubInterface, args []<span class="keyword">string</span>)</span><span class="params">(<span class="keyword">string</span>, error)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(args) != <span class="number">3</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>, fmt.Errorf(<span class="string">"给定的参数错误"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    err := stub.PutState(args[<span class="number">0</span>], []<span class="keyword">byte</span>(args[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>, fmt.Errorf(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    err = stub.SetEvent(args[<span class="number">2</span>], []<span class="keyword">byte</span>&#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>, fmt.Errorf(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">string</span>(args[<span class="number">0</span>]), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(stub shim.ChaincodeStubInterface, args []<span class="keyword">string</span>)</span><span class="params">(<span class="keyword">string</span>, error)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(args) != <span class="number">1</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>, fmt.Errorf(<span class="string">"给定的参数错误"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    result, err := stub.GetState(args[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>, fmt.Errorf(<span class="string">"获取数据发生错误"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> result == <span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>, fmt.Errorf(<span class="string">"根据 %s 没有获取到相应的数据"</span>, args[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">string</span>(result), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    err := shim.Start(<span class="built_in">new</span>(SimpleChaincode))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">        fmt.Printf(<span class="string">"启动SimpleChaincode时发生错误: %s"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>链码编写好以后，我们需要使用 Fabric-SDK-Go 提供的相关 API 来实现对链码的安装及实例化操作，而无需在命令提示符中输入烦锁的相关操作命令。</p>
<h2 id="四、使用Fabric－SDK实现链码的自动部署"><a href="#四、使用Fabric－SDK实现链码的自动部署" class="headerlink" title="四、使用Fabric－SDK实现链码的自动部署"></a>四、使用Fabric－SDK实现链码的自动部署</h2><h4 id="目标-3"><a href="#目标-3" class="headerlink" title="目标"></a>目标</h4><ol>
<li>使用SDK相关的API实现对链码的安装及实例化</li>
<li>通过测试</li>
</ol>
<h2 id="1-链码安装及实例化"><a href="#1-链码安装及实例化" class="headerlink" title="1 链码安装及实例化"></a>1 链码安装及实例化</h2><h3 id="1-编辑结构体"><a href="#1-编辑结构体" class="headerlink" title="1 编辑结构体"></a>1 编辑结构体</h3><p>新建一个结构体，声明在 <code>sdkInit/fabricInitInfo.go</code> 文件中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim sdkInit/fabricInitInfo.go</span></span><br></pre></td></tr></table></figure>

<p><code>fabricInitInfo.go</code> 文件完整内容如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  author: hanxiaodong</span></span><br><span class="line"><span class="comment">  QQ群（专业Fabric交流群）：862733552</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> sdkInit</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/hyperledger/fabric-sdk-go/pkg/client/resmgmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> InitInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">    ChannelID     <span class="keyword">string</span></span><br><span class="line">    ChannelConfig <span class="keyword">string</span></span><br><span class="line">    OrgAdmin      <span class="keyword">string</span></span><br><span class="line">    OrgName       <span class="keyword">string</span></span><br><span class="line">    OrdererOrgName    <span class="keyword">string</span></span><br><span class="line">    OrgResMgmt *resmgmt.Client</span><br><span class="line"></span><br><span class="line">    ChaincodeID    <span class="keyword">string</span></span><br><span class="line">    ChaincodeGoPath    <span class="keyword">string</span></span><br><span class="line">    ChaincodePath    <span class="keyword">string</span></span><br><span class="line">    UserName    <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以从上面的源代码中看到，在这个结构体中，我们新增加了与链码相关的如下成员：</p>
<ul>
<li><strong>ChaincodeID：</strong>链码ID（即链码名称）</li>
<li><strong>ChaincodeGoPath：</strong>系统GOPATH路径</li>
<li><strong>ChaincodePath：</strong>链 码源代码所在路径</li>
<li><strong>UserName：</strong>组织用户名称</li>
</ul>
<h3 id="2-使用Fabric-SDK安装及实例化链码"><a href="#2-使用Fabric-SDK安装及实例化链码" class="headerlink" title="2 使用Fabric-SDK安装及实例化链码"></a>2 使用Fabric-SDK安装及实例化链码</h3><p>编辑 <code>sdkInit/start.go</code> 文件，利用Fabric-SDK提供的接口，对链码进行安装及实例化</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim sdkInit/start.go</span></span><br></pre></td></tr></table></figure>

<p>在 <code>start.go</code> 文件中声明一个 <code>InstallAndInstantiateCC</code> 函数，该函数的主要功能有三项：</p>
<ol>
<li><strong>安装链码</strong></li>
<li><strong>实例化链码</strong></li>
<li><strong>创建客户端实例</strong></li>
</ol>
<p>在 <code>start.go</code> 文件中添加如下<code>InstallAndInstantiateCC</code> 函数内容并导入相应的package：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    [......]</span><br><span class="line"></span><br><span class="line">    <span class="string">"github.com/hyperledger/fabric-sdk-go/pkg/fab/ccpackager/gopackager"</span></span><br><span class="line">    <span class="string">"github.com/hyperledger/fabric-sdk-go/third_party/github.com/hyperledger/fabric/common/cauthdsl"</span></span><br><span class="line">    <span class="string">"github.com/hyperledger/fabric-sdk-go/pkg/client/channel"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// hanxiaodong</span></span><br><span class="line"><span class="comment">// QQ群（专业Fabric交流群）：862733552</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InstallAndInstantiateCC</span><span class="params">(sdk *fabsdk.FabricSDK, info *InitInfo)</span> <span class="params">(*channel.Client, error)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"开始安装链码......"</span>)</span><br><span class="line">    <span class="comment">// creates new go lang chaincode package</span></span><br><span class="line">    ccPkg, err := gopackager.NewCCPackage(info.ChaincodePath, info.ChaincodeGoPath)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"创建链码包失败: %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// contains install chaincode request parameters</span></span><br><span class="line">    installCCReq := resmgmt.InstallCCRequest&#123;Name: info.ChaincodeID, Path: info.ChaincodePath, Version: ChaincodeVersion, Package: ccPkg&#125;</span><br><span class="line">    <span class="comment">// allows administrators to install chaincode onto the filesystem of a peer</span></span><br><span class="line">    _, err = info.OrgResMgmt.InstallCC(installCCReq, resmgmt.WithRetry(retry.DefaultResMgmtOpts))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"安装链码失败: %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"指定的链码安装成功"</span>)</span><br><span class="line">    fmt.Println(<span class="string">"开始实例化链码......"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  returns a policy that requires one valid</span></span><br><span class="line">    ccPolicy := cauthdsl.SignedByAnyMember([]<span class="keyword">string</span>&#123;<span class="string">"org1.kevin.kongyixueyuan.com"</span>&#125;)</span><br><span class="line"></span><br><span class="line">    instantiateCCReq := resmgmt.InstantiateCCRequest&#123;Name: info.ChaincodeID, Path: info.ChaincodePath, Version: ChaincodeVersion, Args: [][]<span class="keyword">byte</span>&#123;[]<span class="keyword">byte</span>(<span class="string">"init"</span>)&#125;, Policy: ccPolicy&#125;</span><br><span class="line">    <span class="comment">// instantiates chaincode with optional custom options (specific peers, filtered peers, timeout). If peer(s) are not specified</span></span><br><span class="line">    _, err = info.OrgResMgmt.InstantiateCC(info.ChannelID, instantiateCCReq, resmgmt.WithRetry(retry.DefaultResMgmtOpts))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"实例化链码失败: %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"链码实例化成功"</span>)</span><br><span class="line"></span><br><span class="line">    clientChannelContext := sdk.ChannelContext(info.ChannelID, fabsdk.WithUser(info.UserName), fabsdk.WithOrg(info.OrgName))</span><br><span class="line">    <span class="comment">// returns a Client instance. Channel client can query chaincode, execute chaincode and register/unregister for chaincode events on specific channel.</span></span><br><span class="line">    channelClient, err := channel.New(clientChannelContext)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"创建应用通道客户端失败: %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"通道客户端创建成功，可以利用此客户端调用链码进行查询或执行事务."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> channelClient, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-在main中调用"><a href="#3-在main中调用" class="headerlink" title="3 在main中调用"></a>3 在main中调用</h3><p>编辑 <code>main.go</code> 文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim main.go</span></span><br></pre></td></tr></table></figure>

<p><code>main.go</code> 完整内容如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  author: hanxiaodong</span></span><br><span class="line"><span class="comment">  QQ群（专业Fabric交流群）：862733552</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"github.com/kongyixueyuan.com/kongyixueyuan/sdkInit"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    configFile = <span class="string">"config.yaml"</span></span><br><span class="line">    initialized = <span class="literal">false</span></span><br><span class="line">    SimpleCC = <span class="string">"simplecc"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    initInfo := &amp;sdkInit.InitInfo&#123;</span><br><span class="line"></span><br><span class="line">        ChannelID: <span class="string">"kevinkongyixueyuan"</span>,</span><br><span class="line">        ChannelConfig: os.Getenv(<span class="string">"GOPATH"</span>) + <span class="string">"/src/github.com/kongyixueyuan.com/kongyixueyuan/fixtures/artifacts/channel.tx"</span>,</span><br><span class="line"></span><br><span class="line">        OrgAdmin:<span class="string">"Admin"</span>,</span><br><span class="line">        OrgName:<span class="string">"Org1"</span>,</span><br><span class="line">        OrdererOrgName: <span class="string">"orderer.kevin.kongyixueyuan.com"</span>,</span><br><span class="line"></span><br><span class="line">        ChaincodeID: SimpleCC,</span><br><span class="line">        ChaincodeGoPath: os.Getenv(<span class="string">"GOPATH"</span>),</span><br><span class="line">        ChaincodePath: <span class="string">"github.com/kongyixueyuan.com/kongyixueyuan/chaincode/"</span>,</span><br><span class="line">        UserName:<span class="string">"User1"</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sdk, err := sdkInit.SetupSDK(configFile, initialized)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(err.Error())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> sdk.Close()</span><br><span class="line"></span><br><span class="line">    err = sdkInit.CreateChannel(sdk, initInfo)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err.Error())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    channelClient, err := sdkInit.InstallAndInstantiateCC(sdk, initInfo)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err.Error())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(channelClient)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-测试"><a href="#4-测试" class="headerlink" title="4 测试"></a>4 测试</h3><p>执行 <code>make</code> 命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> make</span></span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<p><img src="http://image.chaindesk.cn/11.1_6.png/mark" alt="cc实例化成功"></p>
<p>在此，我们已经成功搭建了 Hyperledger Fabric 的网络环境，并通过 <code>fabric-sdk-go</code> 创建了应用通道，将peers加入通道，并在peer上安装、实例化了链码。那么如何在真正的应用程序中实现链码的调用，对分类账本中的状态进行操作，具体实现请参见下一章的内容。</p>
<h4 id="FAQ-1"><a href="#FAQ-1" class="headerlink" title="FAQ"></a>FAQ</h4><ol>
<li><p>创建应用通道客户端有什么作用？</p>
<p>应用通道客户端其实就是一个客户端实例。通过该实例，可以使用 fabric-sdk-go 相应的 API 查询链码，执行链码，对特定通道上的链码事件进行注册/注销。</p>
</li>
</ol>
<p>本文地址: <a href="https://www.chaindesk.cn/witbook/11/216" target="_blank" rel="noopener">https://www.chaindesk.cn/witbook/11/216</a></p>
<p><a href="http://zzi.ycyues.top/?mod=m_contribute&amp;id=4157&amp;tid=5" target="_blank" rel="noopener">http://zzi.ycyues.top/?mod=m_contribute&amp;id=4157&amp;tid=5</a></p>
<p><a href="http://www.sicris.cn/CN/column/column42.shtml" target="_blank" rel="noopener">http://www.sicris.cn/CN/column/column42.shtml</a></p>
<p><a href="http://aqjs.chinajournal.net.cn/WKE/WebPublication/wkTextContent.aspx?navigationContentID=0a96be87-490b-49ff-90aa-bee7b5d1b2cc&amp;mid=aqjs" target="_blank" rel="noopener">http://aqjs.chinajournal.net.cn/WKE/WebPublication/wkTextContent.aspx?navigationContentID=0a96be87-490b-49ff-90aa-bee7b5d1b2cc&amp;mid=aqjs</a></p>
<p><a href="http://zgxxaq.goooc.net/" target="_blank" rel="noopener">http://zgxxaq.goooc.net/</a></p>
<p><a href="http://netinfo-security.org/CN/column/column52.shtml" target="_blank" rel="noopener">http://netinfo-security.org/CN/column/column52.shtml</a></p>
<p><a href="http://wlaqhxxh.goooc.net/buy/" target="_blank" rel="noopener">http://wlaqhxxh.goooc.net/buy/</a></p>
<p><a href="http://www.wlaq-qikan.com/list-2.html" target="_blank" rel="noopener">http://www.wlaq-qikan.com/list-2.html</a></p>
<h2 id="寻找一种可以理解的共识算法Raft"><a href="#寻找一种可以理解的共识算法Raft" class="headerlink" title="寻找一种可以理解的共识算法Raft"></a>寻找一种可以理解的共识算法Raft</h2><h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><p>Raft是用于管理复制日志的共识算法。 它产生的结果与（多个）Paxos等效，并且效率与Paxos相同，但是其结构与Paxos不同； 这使得Raft比Paxos更易于理解，并且为构建实用系统提供了更好的基础。 为了增强可理解性，Raft分离了共识的关键要素，例如领导者选举，日志复制和安全性，并强制实施了更高程度的一致性以减少必须考虑的状态数。 一项用户研究的结果表明，与Paxos相比，筏更易于学生学习。 Raft还包括用于更改集群成员资格的新机制，该机制使用重叠的多数来保证安全。</p>
<h4 id="1引言"><a href="#1引言" class="headerlink" title="1引言"></a>1引言</h4><p>​        共识算法允许一组计算机作为一个连贯的组工作，这些组可以在某些成员的故障中幸存下来。因此，它们在构建可靠的大规模软件系统中起着关键作用。在过去的十年中，Paxos [15，16]主导了共识算法的讨论：共识的大多数实现都基于Paxos或受其影响，并且Paxos已成为用于教导学生有关共识的主要工具。<br>​         不幸的是，尽管有很多尝试使Paxos变得更容易上手，但它仍然很难理解。此外，其体系结构需要复杂的更改以支持实际系统。结果，系统构建者和学生都与Paxos斗争。<br>​        在与Paxos自己奋斗之后，我们着手寻找一种新的共识算法，该算法可以为系统构建和教育提供更好的基础。我们的方法与众不同，因为我们的主要目标是可理解性：我们可以为实际系统定义共识算法，并以比Paxos容易得多的方式对其进行描述吗？此外，我们希望该算法能够促进对系统构建者必不可少的直觉的发展。重要的不仅是算法能起作用，而且很明显它为什么起作用。<br>​          这项工作的结果是一个称为Raft的共识算法。在设计Raft时，我们应用了特定的技术来提高可理解性，包括分解（Raft分离了领导者的选举，日志复制和安全性）。此技术报告是[32]的扩展版本；其他材料在页边距中用灰色条表示。 2014年5月20日发布。声明了减少空间的功能（相对于Paxos，Raft减少了不确定性的程度以及服务器之间可能不一致的方式）。一项对两所大学的43名学生进行的用户研究表明，Raft比Paxos更容易理解：学习了两种算法后，其中33位学生比Rax更好地回答了有关Raft的问题。</p>
<p>​       Raft在许多方面与现有的共识算法相似（最著名的是Oki和Liskov的Viewstamped复制[29，22]），但是它具有几个新颖的功能：<br>​       •强大的领导者：与其他共识算法相比，筏使用了更强大的领导形式。例如，日志条目仅从领导者流向其他服务器。这简化了复制日志的管理，并使Raft更易于理解。<br>​        •领导人选举：筏使用随机计时器选举领导人。这为任何共识算法已经要求的心跳仅增加了少量机制，同时简单，快速地解决了冲突。<br>​        •成员资格更改：Raft用于更改集群中服务器集的机制使用了一种新的联合共识方法，其中两种不同配置的大多数在转换过程中会重叠。这允许群集在配置更改期间继续正常运行。</p>
<p>​        我们认为Raft在教育目的和实施基础上均优于Paxos和其他共识算法。它比其他算法更简单易懂。它的描述足够完整，可以满足实际系统的需求；它具有几种开源实现，并被多家公司使用；其安全性能已得到正式规定和证明；而且其效率可与其他算法媲美。<br>​        本文的其余部分介绍了复制状态机问题（第2节），讨论了Paxos的优缺点（第3节），描述了我们对易懂性的一般方法（第4节），介绍了Raft共识算法（第5-8节） ，评估Raft（第9节），并讨论相关工作（第10节）。</p>
<h4 id="2个复制状态机"><a href="#2个复制状态机" class="headerlink" title="2个复制状态机"></a>2个复制状态机</h4><p>共识算法通常出现在复制状态机的环境中[37]。通过这种方法，服务器集合上的状态机将计算相同状态的相同副本，并且即使某些服务器已关闭也可以继续运行。复制状态机是</p>
<p><img src="C:%5CUsers%5Chuanggang%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200405163727492.png" alt="image-20200405163727492"></p>
<p>图1：复制状态机架构。共识算法管理包含来自客户端的状态机命令的复制日志。状态机处理来自日志的相同命令序列，因此它们产生相同的输出。<br>       用于解决分布式系统中的各种容错问题。例如，具有单个集群领导者的大型系统，例如GFS [8]，HDFS [38]和RAMCloud [33]，通常使用单独的复制状态机来管理领导者选举并存储必须保留的配置信息领导者崩溃。复制状态机的示例包括Chubby [2]和ZooKeeper [11]。<br>        复制状态机通常使用复制日志来实现，如图1所示。每个服务器都存储一个包含一系列命令的日志，其状态机按顺序执行这些命令。每个日志以相同的顺序包含相同的命令，因此每个状态机处理相同的命令序列。由于状态机是确定性的，因此每个状态机都会计算相同的状态和相同的输出顺序。<br>        保持复制日志的一致性是共识算法的工作。服务器上的共识模块接收来自客户端的命令并将其添加到其日志中，并与其他服务器上的共识模块进行通信以确保每个日志最终都以相同顺序包含相同的请求，即使某些服务器发生故障也是如此。正确复制后，每个服务器的状态机将以日志顺序对其进行处理，然后将输出返回给客户端。结果，服务器似乎形成了单个高度可靠的状态机。<br>        实际系统的共识算法通常具有以下属性：<br>•它们可确保在所有非拜占庭条件下的安全性（绝不会返回错误的结果），包括网络延迟，分区，数据包丢失，重复和重新排序。<br>•只要任何大多数服务器都在运行，并且它们彼此之间以及与客户端进行通信，它们就可以正常运行（可用）。因此，由五个服务器组成的典型集群可以容忍任何两个服务器的故障。假定服务器因停止而发生故障；它们稍后可能会从稳定存储上的状态中恢复并重新加入群集。<br>•它们不依赖于时间来确保日志的一致性：错误的时钟和极端的消息延迟在最坏的情况下可能导致可用性问题。<br>•在通常情况下，大多数集群对单轮远程过程调用作出响应后，命令即可完成；少数慢速服务器不必影响整体系统性能</p>
<p>3</p>

    </div>

    
    
    
    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

      
    </div>
        <div class="reward-container">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="Hongery 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="Hongery 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Hongery
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://yoursite.com/2020/03/27/%E8%81%94%E7%9B%9F%E9%93%BE/%E7%AC%AC11%E7%AB%A0Web%E5%AE%9E%E6%88%98-%E4%BD%BF%E7%94%A8Fabric-SDK-Go/" title="第11章Fabric-SDK-Go">http://yoursite.com/2020/03/27/联盟链/第11章Web实战-使用Fabric-SDK-Go/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/blockchain/" rel="tag"># blockchain</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/03/27/%E8%81%94%E7%9B%9F%E9%93%BE/%E7%AC%AC9%E7%AB%A0Fabric%E5%88%86%E5%B8%83%E5%BC%8F%E8%B4%A6%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8/" rel="prev" title="第9章Fabric分布式账本数据存储">
      <i class="fa fa-chevron-left"></i> 第9章Fabric分布式账本数据存储
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/27/%E8%81%94%E7%9B%9F%E9%93%BE/%E7%AC%AC10%E7%AB%A0Fabric-SDK-Go%E7%9A%84Web%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="next" title="第10章Fabric-SDK-Goweb项目">
      第10章Fabric-SDK-Goweb项目 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置Fabric－SDK"><span class="nav-text">配置Fabric－SDK</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一、配置Fabric－SDK"><span class="nav-text">一、配置Fabric－SDK</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#目标"><span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#任务实现"><span class="nav-text">任务实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-配置Fabric－SDK"><span class="nav-text">1 配置Fabric－SDK</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-定义所需结构体"><span class="nav-text">2 定义所需结构体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-创建SDK"><span class="nav-text">3 创建SDK</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-编写测试代码"><span class="nav-text">4 编写测试代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、满足依赖"><span class="nav-text">二、满足依赖</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#目标-1"><span class="nav-text">目标</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-安装dep工具"><span class="nav-text">1 安装dep工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-下载所需依赖"><span class="nav-text">2 下载所需依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-测试Fabric-SDK"><span class="nav-text">3 测试Fabric-SDK</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-关闭网络并清理环境"><span class="nav-text">4 关闭网络并清理环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-利用Makefile简化步骤"><span class="nav-text">5 利用Makefile简化步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#FAQ"><span class="nav-text">FAQ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、链码实现"><span class="nav-text">三、链码实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#目标-2"><span class="nav-text">目标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#任务实现-1"><span class="nav-text">任务实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-编写链码"><span class="nav-text">1 编写链码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、使用Fabric－SDK实现链码的自动部署"><span class="nav-text">四、使用Fabric－SDK实现链码的自动部署</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#目标-3"><span class="nav-text">目标</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-链码安装及实例化"><span class="nav-text">1 链码安装及实例化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-编辑结构体"><span class="nav-text">1 编辑结构体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-使用Fabric-SDK安装及实例化链码"><span class="nav-text">2 使用Fabric-SDK安装及实例化链码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-在main中调用"><span class="nav-text">3 在main中调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-测试"><span class="nav-text">4 测试</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#FAQ-1"><span class="nav-text">FAQ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#寻找一种可以理解的共识算法Raft"><span class="nav-text">寻找一种可以理解的共识算法Raft</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#摘要"><span class="nav-text">摘要</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1引言"><span class="nav-text">1引言</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2个复制状态机"><span class="nav-text">2个复制状态机</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hongery"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Hongery</p>
  <div class="site-description" itemprop="description">直到这一刻微笑着说话为止，我至少留下了一公升眼泪</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">108</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Hongery" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Hongery" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/weixin_40098405" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_40098405" rel="noopener" target="_blank"><i class="fa fa-fw fa-crosshairs"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1281185088@qq.com" title="E-Mail1 → mailto:1281185088@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail1</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hongery@yeah.net" title="E-Mail2 → mailto:hongery@yeah.net" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail2</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hongery</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">NaNm</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">NaN:aN字</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/clicklove.js"></script>
